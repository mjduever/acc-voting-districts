<!DOCTYPE html>
<html lang='en'>

<head>
  <title>ACC Voting Districts</title>
  <meta charset='utf-8'>
  <meta name='viewport' content='width=device-width, initial-scale=1'>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.2.0/dist/leaflet.css" />
  <link href='https://api.mapbox.com/mapbox-assembly/v0.17.0/assembly.min.css' rel='stylesheet'>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet-geocoder-mapzen/1.9.4/leaflet-geocoder-mapzen.css">

  <style>
  .info {
  			padding: 6px 8px;
  			font-size: 1em;
  			background: rgba(255, 255, 255, 0.8);
  			box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
  			border-radius: 5px;
  			text-align: right;
  		}
  		.info h3 {
  			margin: 0;
  		}
  </style>

</head>

<body>
  <div class='grid'>
    <div class='col col--12 col--3-ml px12 viewport-third viewport-full-ml'>
      <div class='h-full scroll-auto relative'>
        <h1 class='txt-h2 mb6'>Athens-Clarke County Voting Districts</h1>
        <p>Find your voting district for local and statewide elections. Enter your address into the search box on the left.</p><br>
        <p>This map shows precincts, commission districts, school board districts, congressional districts, and the state house districts.</p>

        <footer class='mt12 bg-gray-faint txt-s absolute w-full bottom px12'>
          <ul>
            <li>See the original <a class='link' href='http://athensclarkecounty.com/248/Current-District-Maps'>maps</a></li>
            <li>Explore the original <a class='link' href='http://www.legis.ga.gov/Joint/reapportionment/en-US/default.aspx'>data</a></li>
            <li>Map authored by <a class='link' href='#'>M. Duever</a></li>
            </p>
        </footer>
      </div>
    </div>
    <div class='col col--12 col--9-ml h180 h-full-ml'>
    <div id="map" class='viewport-twothirds viewport-full-ml'></div>


    <script src="http://code.jquery.com/jquery-3.1.1.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.2.0/dist/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-geocoder-mapzen/1.9.4/leaflet-geocoder-mapzen.js"></script>
    <script async defer src='https://api.mapbox.com/mapbox-assembly/v0.17.0/assembly.js'></script>
    <script src="https://npmcdn.com/@turf/turf/turf.min.js"></script>

    <script>

//create map
      var map = L.map('map', {
        center: [33.938718, -83.371200], //center map
        zoom: 11.5 //initial zoom level
    });
//add map tile layer, something with streets
      var tiles = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer/tile/{z}/{y}/{x}', {
          attribution: 'Tiles &copy; Esri &mdash; Esri, DeLorme, NAVTEQ',
          maxZoom: 16,
          minZoom: 11
      }).addTo(map);
// add geocoder
      var options = {
        bounds: true,
        position: 'topleft',
        expanded: true
      };

      var geocoder = L.control.geocoder('mapzen-zeZY4Xt', options).addTo(map);


//asynchronous loading of the data, multiple layers
    $.when(
      $.getJSON('data/precincts.json'),
      $.getJSON('data/commission.json'),
      $.getJSON('data/congress.json'),
      $.getJSON('data/house.json'),
      $.getJSON('data/schoolboard.json')
    ).done(function(precincts, commission, congress, house, schoolboard){
        // can access data like this:

        var congressLayer = L.geoJson(congress[0],{
          style: function(feature){
            switch (feature.properties.DISTRICT){
              case '009': return{color:"#66c2a5"};
              case '010': return{color: "#fc8d62"};
            }
          },
          onEachFeature: function(feature, layer){
            var tooltipInfo = "Congressional District: "+ feature.properties.DISTRICT
            layer.bindTooltip(tooltipInfo);
          }
        }).addTo(map);

        var houseLayer = L.geoJson(house[0],{
          style: function(feature){
            switch (feature.properties.DISTRICT){
              case '117': return{color:"#66c2a5"};
              case '118': return{color: "#fc8d62"};
              case '119' : return{color: "#8da0cb"};
            }
          },
          onEachFeature: function(feature, layer){
            var tooltipInfo = "House District: "+ feature.properties.DISTRICT
            layer.bindTooltip(tooltipInfo);
          }
        }).addTo(map);

        var schoolboardLayer = L.geoJson(schoolboard[0],{
          style: function(feature){
            switch (feature.properties.DISTRICT){
              case '001': return{color: "#a6cee3"};
              case '002': return{color: "#1f78b4"};
              case '003': return{color: "#b2df8a"};
              case '004': return{color: "#33a02c"};
              case '005': return{color: "#fb9a99"};
              case '006': return{color: "#e31a1c"};
              case '007': return{color: "#fdbf6f"};
              case '008': return{color: "#ff7f00"};
              case '009': return{color: "#cab2d6"};
            }
          },
          onEachFeature: function(feature, layer){
            var tooltipInfo = "School Board District: "+ feature.properties.DISTRICT
            layer.bindTooltip(tooltipInfo);
          }
        }).addTo(map);

        var commissionLayer = L.geoJson(commission[0],{
          style: function(feature){
            switch (feature.properties.DISTRICT){
              case '001': return{color: "#a6cee3"};
              case '002': return{color: "#1f78b4"};
              case '003': return{color: "#b2df8a"};
              case '004': return{color: "#33a02c"};
              case '005': return{color: "#fb9a99"};
              case '006': return{color: "#e31a1c"};
              case '007': return{color: "#fdbf6f"};
              case '008': return{color: "#ff7f00"};
              case '009': return{color: "#cab2d6"};
              case '010': return{color: "#6a3d9a"};
            }
          },
          onEachFeature: function(feature, layer){
            var tooltipInfo = "Commission District: "+ feature.properties.DISTRICT
            layer.bindTooltip(tooltipInfo);
          }
        }).addTo(map);

        var precinctLayer = L.geoJson(precincts[0],{
          style: function(feature){
            switch (feature.properties.PRECINCT_I){
              case '1A': return{color: "#b2e2e2"};
              case '1B': return{color: "#66c2a4"};
              case '1C': return{color: "#238b45"};
              case '1D': return{color: "#006d2c"};
              case '2A': return{color: "#8c96c6"};
              case '2B': return{color: "#8856a7"};
              case '3A': return{color: "#df65b0"};
              case '3B': return{color: "#dd1c77"};
              case '4A': return{color: "#67a9cf"};
              case '4B': return{color: "#1c9099"};
              case '5A': return{color: "#fdcc8a"};
              case '5B': return{color: "#fc8d59"};
              case '5C': return{color: "#d7301f"};
              case '5D': return{color: "#b30000"};
              case '6A': return{color: "#bdc9e1"};
              case '6B': return{color: "#74a9cf"};
              case '6C': return{color: "#0570b0"};
              case '6D': return{color: "#045a8d"};
              case '7A': return{color: "#edf8b1"};
              case '7B': return{color: "#7fcdbb"};
              case '7C': return{color: "#2c7fb8"};
              case '8A': return{color: "#fff7bc"};
              case '8B': return{color: "#fec44f"};
              case '8C': return{color: "#d95f0e"};
            }
          },
          onEachFeature: function(feature, layer){
            var tooltipInfo = "Precint: "+ feature.properties.PRECINCT_I
            layer.bindTooltip(tooltipInfo);
          }
        }).addTo(map);

// create layer control
      var baseMaps = {
          "Precincts": precinctLayer,
          "Commission Districts": commissionLayer,
          "School Board Districts": schoolboardLayer,
          "State House Districts": houseLayer,
          "Congressional Districts": congressLayer
      };
      var layersControl = new L.Control.Layers(baseMaps, null, {collapsed: false});
      map.addControl(layersControl);

      // listen for
      geocoder.on('select', function(result) {
        // store lat long of result
        var latlng = [result.latlng.lng, result.latlng.lat];

        // create a geojson feature point
        var point = turf.point(latlng);

        // loop through layers of featuregroup
        precinctLayer.eachLayer(function(layer) {

          // convert Leaflet layer to geojson
          var poly = layer.toGeoJSON();

          // if the point is inside the polygon
          if(turf.inside(point, poly)) {

            // we have access to the polygon here
            console.log(poly);

          // ?
          }

        })
        // // loop through layers of featuregroup
        // commissionLayertLayer.eachLayer(function(layer) {
        //
        //   // convert Leaflet layer to geojson
        //   var poly = layer.toGeoJSON();
        //
        //   // if the point is inside the polygon
        //   if(turf.inside(point, poly)) {
        //
        //     // we have access to the polygon here
        //     console.log(poly);
        // return
        //   }
      })


//      call info panel
     drawInfo();
//      updateInfo(precinctLayer, commissionLayer, schoolboardLayer, houseLayer, congressLayer);
}); // end done loading data

function drawInfo() {
			var info = L.control({
				position: 'bottomleft'
			});
			info.onAdd = function(map) {
				var div = L.DomUtil.create('div', 'info');
				return div;
			}
			info.addTo(map);
			$(".info").hide(); //hides info panel when nothing is mousedover
		} //end drawinfo

    // update info pane about districts on mouse click
    function updateInfo(precinctLayer, commissionLayer, schoolboardLayer, houseLayer, congressLayer) {
//    			var props = layer.feature.properties;
      var html = "<h3>" + "Voting Districts</h3>" +
        "Precinct: <b>" + precinctLayer.feature.properties["PRECINCT_I"] + "</b><br>" +
        "Commission District: <b>" + commissionLayer.feature.properties["DISTRICT"] + "</b><br>" +
        "School Board District: <b>" + schoolboardLayer.feature.properties["DISTRICT"] + "</b><br>" +
        "House District: <b>" + houseLayer.feature.properties["DISTRICT"] + "</b>" +
        "Congressional District: <b>" + congressLayer.feature.properties["DISTRICT"] + "</b>"
      $(".info").html(html);
    } //end updateInfo(layer)



</script>

</body>

</html>
